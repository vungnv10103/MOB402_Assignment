<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />ư
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

	<!-- Boxicons -->
	<link href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css" rel="stylesheet" />
	<!-- My CSS -->
	<link rel="stylesheet" href="/public/css/main.css" />

	<title>
		<%= title %>
	</title>
</head>

<body>
	<!-- SIDEBAR -->
	<section id="sidebar">
		<a href="#" class="brand">
			<i class="bx bxs-smile"></i>
			<span class="text">
				<%= title%>
			</span>
		</a>
		<ul class="side-menu top">
			<li class="active">
				<a href="/main">
					<i class="bx bxs-dashboard"></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li>
				<a href="#">
					<i class="bx bxs-shopping-bag-alt"></i>
					<span class="text">My Store</span>
				</a>
			</li>
			<li>
				<a href="#">
					<i class="bx bxs-doughnut-chart"></i>
					<span class="text">Analytics</span>
				</a>
			</li>
			<li>
				<a href="../../api/manage/product">
					<i class="bx bxs-pie-chart"></i>
					<span class="text">Quản lí sản phẩm</span>
				</a>
			</li>
			<li>
				<a href="/api/users">
					<i class="bx bxs-group"></i>
					<span class="text">Quản lí người dùng</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
				<a href="#">
					<i class="bx bxs-cog"></i>
					<span class="text">Settings</span>
				</a>
			</li>
			<li>
				<a href="#" class="logout">
					<i class="bx bxs-log-out-circle"></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>
	<!-- SIDEBAR -->

	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class="bx bx-menu"></i>
			<a href="#" class="nav-link">Categories</a>
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search..." />
					<button type="submit" class="search-btn">
						<i class="bx bx-search"></i>
					</button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden />
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class="bx bxs-bell"></i>
				<span class="num">8</span>
			</a>
			<a href="#" class="profile">
				<img src="/public/images/chick.png" />
			</a>
		</nav>
		<!-- NAVBAR -->

		<main>
			<div class="head-title">
				<div class="left">
					<h1>Quản lí sản phẩm</h1>
					<ul class="breadcrumb">
						<li>
							<a href="#">Quản lí nhân viên</a>
						</li>
						<li><i class="bx bx-chevron-right"></i></li>
						<li>
							<a class="active" onclick="toggleForm()">Thêm</a>
						</li>
					</ul>
				</div>
			</div>

			<form id="formInfo" action="/api/add/product" method="post" style="display: none;">
				<div class="form-group">
					<label for="">Mã sản phẩm</label>
					<input type="text" name="maSP" id="maSP" class="form-control" placeholder=""
						aria-describedby="helpId" />
				</div>
				<div class="form-group">
					<label for="">Tên sản phẩm</label>
					<input type="text" name="name" id="name" class="form-control" placeholder=""
						aria-describedby="helpId" />
				</div>
				<div class="form-group">
					<label for="">Đơn giá</label>
					<input type="number" name="price" id="price" class="form-control" placeholder=""
						aria-describedby="helpId" />
				</div>

				<div class="form-group">
					<label for="">Màu sắc</label>
					<input type="text" name="color" id="color" class="form-control" placeholder=""
						aria-describedby="helpId" />
				</div>
				<div class="form-group">
					<label for="">Loại sản phẩm</label>
					<input type="text" name="loaiSP" id="loaiSP" class="form-control" placeholder=""
						aria-describedby="helpId" />
				</div>
				<div class="form-group">
					<label for="">Mã KH</label>
					<input type="text" name="maKH" id="maKH" class="form-control" placeholder=""
						aria-describedby="helpId" />
				</div>
				<div class="form-group">
					<label for="">Tên KH</label>
					<input type="text" name="nameKH" id="nameKH" class="form-control" placeholder=""
						aria-describedby="helpId" />
				</div>
				<div class="form-group" id="formUpload">
					<label for="">Hình ảnh</label>
					<input type="file" name="image" accept="image/*" />
				</div>


				<button type="submit" class="btn btn-primary">Thêm</button>
				<button id="edit" name="edit" type="reset" class="btn btn-success">
					Sửa
				</button>
			</form>

			<table style="margin-top: 50px" id="tableId" class="table table-striped table-bordered table-hover">
				<thead>
					<tr>
						<th>Mã SP</th>
						<th>Tên SP</th>
						<th>Đơn giá</th>
						<th>Hình ảnh</th>
						<th>Màu sắc</th>
						<th>Loại sản phẩm</th>
						<th>Mã KH</th>
						<th>Tên KH</th>
						<th>Action</th>
					</tr>
				</thead>
				<tbody>
					<% for (let i=0; i < data.length; i++) { %>
						<tr>
							<td>
								<%= data[i].maSP %>
							</td>
							<td>
								<%= data[i].name %>
							</td>
							<td>
								<%= data[i].price %>
							</td>
							<td>
								<img style="width: 50px; height: 40px;"
									src="http://localhost:3000/public/images/<%= data[i].image %>"
									alt="<%= data[i].image %>">
								<!-- <%= data[i].image %> -->
							</td>
							<td>
								<%= data[i].color %>
							</td>
							<td>
								<%= data[i].loaiSP %>
							</td>
							<td>
								<%= data[i].maKH %>
							</td>
							<td>
								<%= data[i].nameKH %>
							</td>
							<td>
								<button class="btn btn-primary edit" data-id="<%= data[i].maSP %>">Edit</button>
								<button class="btn btn-danger delete" data-id="<%= data[i].maSP %>">Delete</button>
								<!-- Modal -->
								<div class="modal fade" id="editModal" tabindex="-1" role="dialog"
									aria-labelledby="editModalLabel" aria-hidden="true">
									<div class="modal-dialog" role="document">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title" id="editModalLabel">Edit Product</h5>
												<button type="button" class="close" data-dismiss="modal"
													aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
											</div>
											<div class="modal-body">
												<form action="/api/manage/product/update/<%= data[i].maSP %>"
													method="post">
													<div class="form-group">
														<label for="">Mã sản phẩm</label>
														<input type="text" name="maSP" id="emaSP" class="form-control"
															placeholder="" aria-describedby="helpId" readonly/>
													</div>
													<div class="form-group">
														<label for="">Tên sản phẩm</label>
														<input type="text" name="name" id="ename" class="form-control"
															placeholder="" aria-describedby="helpId" />
													</div>
													<div class="form-group">
														<label for="">Đơn giá</label>
														<input type="number" name="price" id="eprice"
															class="form-control" placeholder=""
															aria-describedby="helpId" />
													</div>
													<div class="form-group">
														<label for="">Hình ảnh</label>
														<input type="file" name="image" accept="image/*" />
													</div>
													<div class="form-group">
														<label for="">Màu sắc</label>
														<input type="text" name="color" id="ecolor" class="form-control"
															placeholder="" aria-describedby="helpId" />
													</div>
													<div class="form-group">
														<label for="">Loại sản phẩm</label>
														<input type="text" name="loaiSP" id="eloaiSP"
															class="form-control" placeholder=""
															aria-describedby="helpId" />
													</div>
													<div class="form-group">
														<label for="">Mã KH</label>
														<input type="text" name="maKH" id="emaKH" class="form-control"
															placeholder="" aria-describedby="helpId" />
													</div>
													<div class="form-group">
														<label for="">Tên KH</label>
														<input type="text" name="nameKH" id="enameKH"
															class="form-control" placeholder=""
															aria-describedby="helpId" />
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-secondary"
															data-dismiss="modal">Cancel</button>
														<button type="submit" class="btn btn-primary"
															id="save-changes">Save
															Changes</button>
													</div>
												</form>
											</div>
										</div>
									</div>
								</div>
							</td>
						</tr>
						<% } %>
				</tbody>
			</table>
		</main>
		<!-- MAIN -->
	</section>
	<!-- CONTENT -->

	<script src="/public/js/home.js"></script>
</body>

</html>
<script>
	function toggleForm() {
		var form = document.getElementById("formInfo");

		if (form.style.display === "none") {
			form.style.display = "block";
		} else {
			form.style.display = "none";
		}
	}
	$(document).ready(function () {
		// Edit button click event
		$(document).on("click", ".edit", function () {
			// Get staff ID from button's data attribute
			const idProduct = $(this).data("id");
			$.ajax({
				url: "/api/manage/product/" + idProduct,
				method: "GET",
				success: function (data) {
					$('#emaSP').val(data.data.maSP);
					$('#ename').val(data.data.name);
					$('#eprice').val(data.data.price);
					$('#ecolor').val(data.data.color);
					$('#eloaiSP').val(data.data.loaiSP);
					$('#emaKH').val(data.data.maKH);
					$('#enameKH').val(data.data.nameKH);

					// Show the modal
					$('#editModal').modal('show');
				},
				error: function () {
					console.log("Error fetching staff data.");
				},
			});
		});
		// Delete button click event
		$(document).on("click", ".delete", function () {
			const idProduct = $(this).data("id");

			if (confirm(`Bạn có chắc chắn muốn xoá bản ghi này? ${idProduct}`)) {
				$.ajax({
					url: "/api/manage/product/delete/" + idProduct,
					type: "DELETE",
					success: function (result) {
						location.reload();
						// $("table#tableId tbody tr[data-id='" + result.deletedProductID + "']").remove();
					},
					error: function (err) {
						console.log(err);
					},
				});
			}
		});
		$("#save-changes").click(function () {
			// Get the updated data from the form inputs
			var maSP = $("#emaSP").val();
			var name = $("#ename").val();
			var price = $("#eprice").val();
			var image = $("#eimage").val();
			var color = $("#ecolor").val();
			var loaiSP = $("#eloaiSP").val();
			var maKH = $("#emaKH").val();
			var nameKH = $("#enameKH").val();

			// Send the updated data to the server
			$.ajax({
				url: "/api/manage/product/update/" + maSP,
				type: "POST",
				success: function (data) {
					// Handle the server's response here
					// alert("Product updated successfully!");
					$("#editModal").modal("hide");
				},
				error: function (xhr, status, error) {
					// Handle the error here
					alert("An error occurred while updating the product. Please try again later.");
				}
			});
		});
	});

</script>